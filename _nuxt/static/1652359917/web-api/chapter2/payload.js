__NUXT_JSONP__("/web-api/chapter2", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD){return {data:[{document:{slug:"chapter2",description:ab,title:ab,position:200,category:"Web API的設計與開發",menuTitle:"Chapter 02",contributors:["changemyminds","spyua"],toc:[{id:ac,depth:2,text:ad},{id:ae,depth:H,text:"2.6. 陽春認證"},{id:af,depth:H,text:ag},{id:ah,depth:H,text:ai},{id:aj,depth:H,text:ak},{id:al,depth:H,text:"2.10 Authorization Code"}],body:{type:"root",children:[{type:a,tag:q,props:{id:"tags-backend-web-api"},children:[{type:a,tag:h,props:{href:"#tags-backend-web-api",ariaHidden:i,tabIndex:j},children:[{type:a,tag:k,props:{className:[l,m]},children:[]}]},{type:b,value:"tags: "},{type:a,tag:p,props:{},children:[{type:b,value:"BackEnd"}]},{type:b,value:" "},{type:a,tag:p,props:{},children:[{type:b,value:"Web API"}]}]},{type:b,value:c},{type:a,tag:"h2",props:{id:ac},children:[{type:a,tag:h,props:{href:"#%E9%97%9C%E6%96%BC%E7%99%BB%E9%8C%84oauth2026210",ariaHidden:i,tabIndex:j},children:[{type:a,tag:k,props:{className:[l,m]},children:[]}]},{type:b,value:ad}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"OAuth在API設計上是蠻重要的一環，你一定很常遇到在使用某個網頁時，他會想要你Google或是Facebook的資料，此時頁面會導向一個小視窗要你輸入Google或Facebook的帳號密碼，輸入完畢後接著就會導回原本的網頁。接著網頁就可以獲取你Google與FB的相關資訊了。這種B網頁要向你索取第三方網頁的認證工作，就是OAuth會替你處理掉。"}]},{type:b,value:c},{type:a,tag:I,props:{id:ae},children:[{type:a,tag:h,props:{href:"#26-%E9%99%BD%E6%98%A5%E8%AA%8D%E8%AD%89",ariaHidden:i,tabIndex:j},children:[{type:a,tag:k,props:{className:[l,m]},children:[]}]},{type:b,value:"2.6. "},{type:a,tag:h,props:{href:am,rel:[D,E,F],target:G},children:[{type:b,value:"陽春認證"}]}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"上述描述的認證工作，最簡易的認證機制如下圖，使用者在客戶端透過基本的帳號與密碼向後端伺服器驗證身份。伺服器會經過一連串的驗證流程，驗證成功後透過如 Session \u002F Cookie 機制，在客戶端保存用戶登入的狀態資訊。"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:a,tag:r,props:{alt:s,src:"https:\u002F\u002Fi.imgur.com\u002Fh22L2dC.png"},children:[]}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"此陽春認證大致會有幾個問題"}]},{type:b,value:c},{type:a,tag:J,props:{},children:[{type:b,value:c},{type:a,tag:n,props:{},children:[{type:b,value:"1.第三方程式必須儲存 Resource Owner 的帳號密碼，通常是明文儲存。"}]},{type:b,value:c},{type:a,tag:n,props:{},children:[{type:b,value:"2.Server 必須支援密碼認證，即使密碼有天生的資訊安全上的弱點。"}]},{type:b,value:c},{type:a,tag:n,props:{},children:[{type:b,value:"3.第三方程式會得到幾乎完整的權限，可以存取 Protected Resources ，而 Resource Owner 沒辦法限制第三方程式可以拿取 Resource 的時效，以及可以存取的範圍 (subset)。"}]},{type:b,value:c},{type:a,tag:n,props:{},children:[{type:b,value:"4.任何第三方程式被破解 (compromized)，就會導致使用該密碼的所有資料被破解。"}]},{type:b,value:c}]},{type:b,value:c},{type:a,tag:I,props:{id:af},children:[{type:a,tag:h,props:{href:"#27-oauth%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%AA%8D%E8%AD%89%E6%A9%9F%E5%88%B6",ariaHidden:i,tabIndex:j},children:[{type:a,tag:k,props:{className:[l,m]},children:[]}]},{type:b,value:ag}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"那麼OAuth在第三方認證這流程上，中間到底發生什麼事情，我們可以看下述圖意流程"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:a,tag:r,props:{alt:s,src:"https:\u002F\u002Fi.imgur.com\u002FViUvehH.png"},children:[]}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"Step1: User點下允許訪位Facebook個人資訊認證"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"Step2: 第三方網頁請求認可"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"Step3: User輸入帳命並告知Facebook可以把Token轉交給第三方網頁"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"Step4: 將Token轉交給第三方網頁"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"Step5: 第三方網頁帶取Token向Facebook調用索取資訊API"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"Step6: Facebook Response請求給第三方網頁"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"上述OAuth常見的基本流程，使用OAuth方便的是，User無須再次對請求輸入帳號密碼，認證過程中會通過Facebook提供的頁面(一般常見為帳號密碼輸入或是認證許可按鈕如下圖)。"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:a,tag:r,props:{alt:s,src:"https:\u002F\u002Fi.imgur.com\u002FBDIm3EB.png"},children:[]}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"如果OAuth訪問成功就可從Facebook獲取access token，通過此token，第三方網頁就可訪問Facebook用戶允許的相關訊息(public profile mail 介紹..)。"}]},{type:b,value:c},{type:a,tag:I,props:{id:ah},children:[{type:a,tag:h,props:{href:"#28-oauth-20-%E7%9A%84%E8%A7%92%E8%89%B2%E5%AE%9A%E7%BE%A9",ariaHidden:i,tabIndex:j},children:[{type:a,tag:k,props:{className:[l,m]},children:[]}]},{type:b,value:ai}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"Resource Owner - 可以授權別人去存取 Protected Resource 。如果這個角色是人類的話，則就是指使用者 (end-user)。"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"Resource Server - 存放 Protected Resource 的伺服器，可以根據 Access Token 來接受 Protected Resource 的請求。"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"Client - 代表 Resource Owner 去存取 Protected Resource 的應用程式。 “Client” 一詞並不指任何特定的實作方式（可以在 Server 上面跑、在一般電腦上跑、或是在其他的設備）。"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"Authorization Server - 在認證過 Resource Owner 並且 Resource Owner 許可之後，核發 Access Token 的伺服器。"}]},{type:b,value:c},{type:a,tag:I,props:{id:aj},children:[{type:a,tag:h,props:{href:"#29-oauth%E7%9A%84%E8%AA%8D%E8%AD%89%E6%B5%81%E7%A8%8B%E5%BD%A2%E5%BC%8Fgrant-type",ariaHidden:i,tabIndex:j},children:[{type:a,tag:k,props:{className:[l,m]},children:[]}]},{type:b,value:ak}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"上述簡單描述OAuth基本流程，但實際的認證流程會有四種形式，推薦此篇"},{type:a,tag:h,props:{href:am,rel:[D,E,F],target:G},children:[{type:b,value:"認識 OAuth 2.0：一次了解各角色、各類型流程的差異"}]},{type:b,value:"。對於四種形式我覺得此篇作者整理得很淺白易懂。這邊我也會直接擷取他對於四種形式的描述來解說。"}]},{type:b,value:c},{type:a,tag:M,props:{},children:[]},{type:b,value:N},{type:a,tag:t,props:{},children:[{type:a,tag:u,props:{},children:[{type:a,tag:f,props:{},children:[{type:a,tag:o,props:{},children:[{type:b,value:"Type"}]},{type:a,tag:o,props:{align:g},children:[{type:b,value:"常見應用"}]}]}]},{type:a,tag:v,props:{},children:[{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:O}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:"有透過Server處理"}]}]},{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:an}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:"Clinet端處理"}]}]},{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:ao}]},{type:a,tag:e,props:{align:g},children:[]}]},{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:ap}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:"M2M(Machine to Machine)"}]}]}]}]},{type:b,value:c},{type:a,tag:M,props:{},children:[]},{type:b,value:c},{type:a,tag:I,props:{id:al},children:[{type:a,tag:h,props:{href:"#210-authorization-code",ariaHidden:i,tabIndex:j},children:[{type:a,tag:k,props:{className:[l,m]},children:[]}]},{type:b,value:"2.10 "},{type:a,tag:P,props:{},children:[{type:b,value:O}]}]},{type:b,value:c},{type:a,tag:q,props:{id:K},children:[{type:a,tag:h,props:{href:"#%E6%B5%81%E7%A8%8B%E7%A4%BA%E6%84%8F",ariaHidden:i,tabIndex:j},children:[{type:a,tag:k,props:{className:[l,m]},children:[]}]},{type:b,value:K}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"常見類型，通常應用在SSR伺服器渲染的設計上，大部分的邏輯處理程式碼以極機密都會保存在Server。"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:a,tag:r,props:{alt:s,src:"https:\u002F\u002Fi.imgur.com\u002Fm2Ednsg.png"},children:[]}]},{type:b,value:c},{type:a,tag:q,props:{id:S},children:[{type:a,tag:h,props:{href:"#%E8%A9%B3%E7%B4%B0%E6%B5%81%E7%A8%8B",ariaHidden:i,tabIndex:j},children:[{type:a,tag:k,props:{className:[l,m]},children:[]}]},{type:b,value:S}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:aq}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"【Client】GET -\u003E 【Authorization Endpoint】"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:ar}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"把參數包在 URI 的 query components 裡面。"}]},{type:b,value:as},{type:a,tag:t,props:{},children:[{type:a,tag:u,props:{},children:[{type:a,tag:f,props:{},children:[{type:a,tag:o,props:{},children:[{type:b,value:w}]},{type:a,tag:o,props:{align:g},children:[{type:b,value:x}]}]}]},{type:a,tag:v,props:{},children:[{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:at}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:p}]}]},{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:T}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:U}]}]},{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:Q}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:au}]}]},{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:V}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:av}]}]},{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:L}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:R}]}]}]}]},{type:b,value:c},{type:a,tag:y,props:{className:[z]},children:[{type:a,tag:A,props:{className:[B,C]},children:[{type:a,tag:p,props:{},children:[{type:b,value:"GET \u002Fauthorize?response_type=code&client_id=s6BhdRkqt3&state=xyz\n    &redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb HTTP\u002F1.1\nHost: server.example.com\n"}]}]}]},{type:b,value:c},{type:a,tag:M,props:{},children:[]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:aw}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"【Authorization Endpoint】 302 Response -\u003E  GET 【Client: Redirection Endpoint】"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:ax}]},{type:b,value:ay},{type:a,tag:t,props:{},children:[{type:a,tag:u,props:{},children:[{type:a,tag:f,props:{},children:[{type:a,tag:o,props:{},children:[{type:b,value:w}]},{type:a,tag:o,props:{align:g},children:[{type:b,value:x}]}]}]},{type:a,tag:v,props:{},children:[{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:p}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:O}]}]},{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:Q}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:"原內部狀態"}]}]}]}]},{type:b,value:c},{type:a,tag:y,props:{className:[z]},children:[{type:a,tag:A,props:{className:[B,C]},children:[{type:a,tag:p,props:{},children:[{type:b,value:"HTTP\u002F1.1 302 Found\nLocation: https:\u002F\u002Fclient.example.com\u002Fcb?code=SplxlOBeZQQYbYS6WxSbIA\n          &state=xyz\n"}]}]}]},{type:b,value:c},{type:a,tag:J,props:{},children:[{type:b,value:c},{type:a,tag:n,props:{},children:[{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"state 如果 (1) 的時候有附上，則 Resopnse 裡面必須有，完全一致的原值。如果原本就沒有，就不需要回傳。"}]},{type:b,value:c}]},{type:b,value:c},{type:a,tag:n,props:{},children:[{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"Authorization Code："}]},{type:b,value:c},{type:a,tag:J,props:{},children:[{type:b,value:c},{type:a,tag:n,props:{},children:[{type:b,value:"必須是短時效的，建議最長 10 分鐘。"}]},{type:b,value:c},{type:a,tag:n,props:{},children:[{type:b,value:"Client 只能使用一次，如果重複使用，Authorization Server 必須拒絕，並且建議撤銷之前透過這個 Grant 核發過的 Tokens"}]},{type:b,value:c},{type:a,tag:n,props:{},children:[{type:b,value:"要綁定 Code ↔ Client ID ↔ Redirection URI 的關係"}]},{type:b,value:c},{type:a,tag:n,props:{},children:[{type:b,value:"長度由 Authorization Server 定義，應寫在文件中， Client 不可以瞎猜。"}]},{type:b,value:c}]},{type:b,value:c}]},{type:b,value:c}]},{type:b,value:c},{type:a,tag:M,props:{},children:[]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"(5) Access Token Request"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:W}]},{type:b,value:N},{type:a,tag:t,props:{},children:[{type:a,tag:u,props:{},children:[{type:a,tag:f,props:{},children:[{type:a,tag:o,props:{},children:[{type:b,value:w}]},{type:a,tag:o,props:{align:g},children:[{type:b,value:x}]}]}]},{type:a,tag:v,props:{},children:[{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:X}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:O}]}]},{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:p}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:"在 (4) 拿到的 Authorization Code"}]}]},{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:V}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:"如果 (A) 有提供，則必須提供一模一樣的。"}]}]},{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:T}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:U}]}]}]}]},{type:b,value:c},{type:a,tag:q,props:{id:"authorization-server-的處理程序"},children:[{type:a,tag:h,props:{href:"#authorization-server-%E7%9A%84%E8%99%95%E7%90%86%E7%A8%8B%E5%BA%8F",ariaHidden:i,tabIndex:j},children:[{type:a,tag:k,props:{className:[l,m]},children:[]}]},{type:b,value:Y}]},{type:b,value:c},{type:a,tag:J,props:{},children:[{type:b,value:c},{type:a,tag:n,props:{},children:[{type:b,value:az}]},{type:b,value:c},{type:a,tag:n,props:{},children:[{type:b,value:aA}]},{type:b,value:c},{type:a,tag:n,props:{},children:[{type:b,value:"確定 Authorization Code 是發給 Client 的\n"},{type:a,tag:J,props:{},children:[{type:b,value:c},{type:a,tag:n,props:{},children:[{type:b,value:"Confidential: 用 Client 的認證過程來證明"}]},{type:b,value:c},{type:a,tag:n,props:{},children:[{type:b,value:"Public: 用 Client ID 來證明"}]},{type:b,value:c}]},{type:b,value:c}]},{type:b,value:c},{type:a,tag:n,props:{},children:[{type:b,value:"驗證 Authorization Code 正確"}]},{type:b,value:c},{type:a,tag:n,props:{},children:[{type:b,value:"如果 (1) 有給 Redirection URI 的話，確定這次給的 Redirection URI 與 (1) 時的一模一樣。"}]},{type:b,value:c}]},{type:b,value:c},{type:a,tag:y,props:{className:[z]},children:[{type:a,tag:A,props:{className:[B,C]},children:[{type:a,tag:p,props:{},children:[{type:b,value:"POST \u002Ftoken HTTP\u002F1.1\nHost: server.example.com\nAuthorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW\nContent-Type: application\u002Fx-www-form-urlencoded\n\ngrant_type=authorization_code&code=SplxlOBeZQQYbYS6WxSbIA\n&redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb\n"}]}]}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"(5) Access Token Response"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"【Client】 \u003C- 【Token Endpoint】"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"若 Access Token Request 合法且有經過授權，則核發 Access Token，同時可以核發 Refresh Token （非必備）。如果 Client 認證失敗，或 Request 不合法，則依照 "},{type:a,tag:h,props:{href:Z,rel:[D,E,F],target:G},children:[{type:b,value:"RFC 6749 Section 5.2"}]},{type:b,value:" 的規定回覆錯誤。"}]},{type:b,value:c},{type:a,tag:y,props:{className:[z]},children:[{type:a,tag:A,props:{className:[B,C]},children:[{type:a,tag:p,props:{},children:[{type:b,value:"HTTP\u002F1.1 200 OK\nContent-Type: application\u002Fjson;charset=UTF-8\nCache-Control: no-store\nPragma: no-cache\n\n{\n  \"access_token\":\"2YotnFZFEjr1zCsicMWpAA\",\n  \"token_type\":\"example\",\n  \"expires_in\":3600,\n  \"refresh_token\":\"tGzv3JOkF0XG5Qx2TlKWIA\",\n  \"example_parameter\":\"example_value\"\n}\n"}]}]}]},{type:b,value:c},{type:a,tag:_,props:{id:"implicit"},children:[{type:a,tag:h,props:{href:"#implicit",ariaHidden:i,tabIndex:j},children:[{type:a,tag:k,props:{className:[l,m]},children:[]}]},{type:a,tag:P,props:{},children:[{type:b,value:an}]}]},{type:b,value:c},{type:a,tag:q,props:{id:"流程示意-1"},children:[{type:a,tag:h,props:{href:"#%E6%B5%81%E7%A8%8B%E7%A4%BA%E6%84%8F-1",ariaHidden:i,tabIndex:j},children:[{type:a,tag:k,props:{className:[l,m]},children:[]}]},{type:b,value:K}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"通常應用在SPA設計，整個應用程式都在前端運行，依需求向後端 API 取得資料。由於整個應用程式都在前端運行，所以會缺少「後端伺服器透過 Authorization Code Grant 交換 Access Token 」的步驟。取而代之的是請 Authorization Server 直接核發 Access Token。"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"這邊要注意最終應用程式就能拿著 Access Token 向 Resource Server 取得資料。特別留意：不像 Authorization Code Flow，這邊是由前端獲得與管理 Access Token，並帶著 Access Token 發出請求前往取得資源，因此在安全性上「相對脆弱」。"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:a,tag:r,props:{alt:s,src:"https:\u002F\u002Fi.imgur.com\u002FUMvZKO9.png"},children:[]}]},{type:b,value:c},{type:a,tag:q,props:{id:"詳細流程-1"},children:[{type:a,tag:h,props:{href:"#%E8%A9%B3%E7%B4%B0%E6%B5%81%E7%A8%8B-1",ariaHidden:i,tabIndex:j},children:[{type:a,tag:k,props:{className:[l,m]},children:[]}]},{type:b,value:S}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:aq}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"【Client】GET -\u003E【Authorization Endpoint】"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:ar}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"把參數包在 URI 的 query component 裡面。"}]},{type:b,value:as},{type:a,tag:t,props:{},children:[{type:a,tag:u,props:{},children:[{type:a,tag:f,props:{},children:[{type:a,tag:o,props:{},children:[{type:b,value:w}]},{type:a,tag:o,props:{align:g},children:[{type:b,value:x}]}]}]},{type:a,tag:v,props:{},children:[{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:at}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:p}]}]},{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:T}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:U}]}]},{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:Q}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:au}]}]},{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:V}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:av}]}]},{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:L}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:R}]}]}]}]},{type:b,value:c},{type:a,tag:q,props:{id:"authorization-server-的處理程序-1"},children:[{type:a,tag:h,props:{href:"#authorization-server-%E7%9A%84%E8%99%95%E7%90%86%E7%A8%8B%E5%BA%8F-1",ariaHidden:i,tabIndex:j},children:[{type:a,tag:k,props:{className:[l,m]},children:[]}]},{type:b,value:Y}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"因為 Implicit Grant Flow 是直接在 Authorization Endpoint 發 Access Token ，所以資料驗證和授權都在這一步處理。所以這個 Request 進來的時候， Authorization Server 要做這些事："}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"驗證所有必須給的參數都有給且合法"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"Redirection URI 與預先在 Authorization Server 設定的相符。\n如果沒問題，就詢問 Resource Owner 是否授權，即 (B) 步驟"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:aw}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"【Client】 \u003C- 302【Authorization Endpoint】"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:ax}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"參數要用 URL Encoding 編起來，放在 Fragment Component 裡面。"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"若 Access Token Request 合法且有經過授權，則核發 Access Token。如果 Client 認證失敗，或 Request 不合法，則依照 Section 5.2 的規定回覆錯誤。"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"特別注意 Implicit Grant Type 禁止 核發 Refresh Token。"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"某些 User-Agent 不支援 Fragment Redirection ，這種情況可以使用間接轉址，即是轉到一個頁面，放一個 “Continue” 的按鈕，按下去連到真正的 Redirection URI 。"}]},{type:b,value:N},{type:a,tag:t,props:{},children:[{type:a,tag:u,props:{},children:[{type:a,tag:f,props:{},children:[{type:a,tag:o,props:{},children:[{type:b,value:w}]},{type:a,tag:o,props:{align:g},children:[{type:b,value:x}]}]}]},{type:a,tag:v,props:{},children:[{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:"access_token"}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:"即 Access Token"}]}]},{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:"expires_in"}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:"建議有\t幾秒過期，如 3600 表示 10 分鐘。若要省略，最好在文件裡註明效期。"}]}]},{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:L}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:"Access Token 的授權範圍 (scopes)。"}]}]},{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:Q}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:"原內部狀態。"}]}]}]}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"其中 scope 如果和 (1) 申請的不同則要附上，如果一樣的話就不必附上。"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"其中 state 如果 (1) 的時候有附上，則 Resopnse 裡面必須有，完全一致的原值。如果原本就沒有，就不需要回傳。"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"Access Token 的長度由 Authorization Server 定義，應寫在文件中， Client 不可以瞎猜。"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"Client 遇到不認識的參數必須忽略。"}]},{type:b,value:c},{type:a,tag:y,props:{className:[z]},children:[{type:a,tag:A,props:{className:[B,C]},children:[{type:a,tag:p,props:{},children:[{type:b,value:"HTTP\u002F1.1 302 Found\nLocation: http:\u002F\u002Fexample.com\u002Fcb#access_token=2YotnFZFEjr1zCsicMWpAA\n          &state=xyz&token_type=example&expires_in=3600\n"}]}]}]},{type:b,value:c},{type:a,tag:_,props:{id:"resource-owner-password-credentials"},children:[{type:a,tag:h,props:{href:"#resource-owner-password-credentials",ariaHidden:i,tabIndex:j},children:[{type:a,tag:k,props:{className:[l,m]},children:[]}]},{type:a,tag:P,props:{},children:[{type:b,value:ao}]}]},{type:b,value:c},{type:a,tag:q,props:{id:"流程示意-2"},children:[{type:a,tag:h,props:{href:"#%E6%B5%81%E7%A8%8B%E7%A4%BA%E6%84%8F-2",ariaHidden:i,tabIndex:j},children:[{type:a,tag:k,props:{className:[l,m]},children:[]}]},{type:b,value:K}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"由使用者提供帳號與密碼等資訊給應用程式，由應用程式直接向 Authorization Server 交換 Access Token，因此「必須是使用者高度信賴的應用程式」才適合使用，且唯有前兩種皆不可行時，才會考慮使用當前類型的流程。"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"體驗上和以往的帳號密碼登入雷同。"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:a,tag:r,props:{alt:s,src:"https:\u002F\u002Fi.imgur.com\u002FN9DUpEB.png"},children:[]}]},{type:b,value:c},{type:a,tag:q,props:{id:$},children:[{type:a,tag:h,props:{href:"#%E6%B5%81%E7%A8%8B%E7%B4%B0%E7%AF%80",ariaHidden:i,tabIndex:j},children:[{type:a,tag:k,props:{className:[l,m]},children:[]}]},{type:b,value:$}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"(2,3) Authorization Request & Response"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"在這個流程裡面， Authorization Grant 就是 Resource Owner 的帳號密碼，所以在 Step (A) 裡面直接向 Resource Onwer 索取，沒有經過網路來取得 Authorization。"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"Spec 不規定 Client 要怎麼拿到帳號密碼，但是 Client 取得 Access Token 之後，必須把 Resource Owner 的帳號密碼給銷毀掉。"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"(4) Access Token Request"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:W}]},{type:b,value:N},{type:a,tag:t,props:{},children:[{type:a,tag:u,props:{},children:[{type:a,tag:f,props:{},children:[{type:a,tag:o,props:{},children:[{type:b,value:w}]},{type:a,tag:o,props:{align:g},children:[{type:b,value:x}]}]}]},{type:a,tag:v,props:{},children:[{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:X}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:aa}]}]},{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:"username"}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:"Resource Owner 的帳號"}]}]},{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:aa}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:"Resource Owner 的密碼"}]}]},{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:L}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:R}]}]}]}]},{type:b,value:c},{type:a,tag:q,props:{id:"authorization-server-的處理程序-2"},children:[{type:a,tag:h,props:{href:"#authorization-server-%E7%9A%84%E8%99%95%E7%90%86%E7%A8%8B%E5%BA%8F-2",ariaHidden:i,tabIndex:j},children:[{type:a,tag:k,props:{className:[l,m]},children:[]}]},{type:b,value:Y}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"這個 Request 進來的時候， Authorization Server 要做這些事："}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:az}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:aA}]},{type:b,value:c},{type:a,tag:_,props:{id:"client-credentials"},children:[{type:a,tag:h,props:{href:"#client-credentials",ariaHidden:i,tabIndex:j},children:[{type:a,tag:k,props:{className:[l,m]},children:[]}]},{type:a,tag:P,props:{},children:[{type:b,value:ap}]}]},{type:b,value:c},{type:a,tag:q,props:{id:"流程示意-3"},children:[{type:a,tag:h,props:{href:"#%E6%B5%81%E7%A8%8B%E7%A4%BA%E6%84%8F-3",ariaHidden:i,tabIndex:j},children:[{type:a,tag:k,props:{className:[l,m]},children:[]}]},{type:b,value:K}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"通常是由應用程式向 Authourization Server 請求取得 Access Token 以獲取「自己」的相關資源，而非使用者的資源。"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"這個流程已經跳脫使用者，因此，使用者身份驗證的流程將不再需要。取而代之的，是應用程式必須向 Authorization Server 提供驗證所需的自身資訊。"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:a,tag:r,props:{alt:s,src:"https:\u002F\u002Fi.imgur.com\u002FuPeIjN5.png"},children:[]}]},{type:b,value:c},{type:a,tag:q,props:{id:"流程細節-1"},children:[{type:a,tag:h,props:{href:"#%E6%B5%81%E7%A8%8B%E7%B4%B0%E7%AF%80-1",ariaHidden:i,tabIndex:j},children:[{type:a,tag:k,props:{className:[l,m]},children:[]}]},{type:b,value:$}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"(1) Access Token Request"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:W}]},{type:b,value:ay},{type:a,tag:t,props:{},children:[{type:a,tag:u,props:{},children:[{type:a,tag:f,props:{},children:[{type:a,tag:o,props:{},children:[{type:b,value:w}]},{type:a,tag:o,props:{align:g},children:[{type:b,value:x}]}]}]},{type:a,tag:v,props:{},children:[{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:X}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:aa}]}]},{type:a,tag:f,props:{},children:[{type:a,tag:e,props:{},children:[{type:b,value:L}]},{type:a,tag:e,props:{align:g},children:[{type:b,value:R}]}]}]}]},{type:b,value:c},{type:a,tag:y,props:{className:[z]},children:[{type:a,tag:A,props:{className:[B,C]},children:[{type:a,tag:p,props:{},children:[{type:b,value:"POST \u002Ftoken HTTP\u002F1.1\nHost: server.example.com\nAuthorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW\nContent-Type: application\u002Fx-www-form-urlencoded\n\ngrant_type=client_credentials\n"}]}]}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"(2) Access Token Response"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"【Client】POST \u003C- 【Token Endpoint】"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"若 Access Token Request 合法且有經過授權，則核發 Access Token，但是最好不要核發 Refresh Token。如果 Client 認證失敗，或 Request 不合法，則依照的"},{type:a,tag:h,props:{href:Z,rel:[D,E,F],target:G},children:[{type:b,value:"RFC6749規定(Section5.2)"}]},{type:b,value:"回覆錯誤。"}]},{type:b,value:c},{type:a,tag:y,props:{className:[z]},children:[{type:a,tag:A,props:{className:[B,C]},children:[{type:a,tag:p,props:{},children:[{type:b,value:"HTTP\u002F1.1 200 OK\nContent-Type: application\u002Fjson;charset=UTF-8\nCache-Control: no-store\nPragma: no-cache\n\n{\n  \"access_token\":\"2YotnFZFEjr1zCsicMWpAA\",\n  \"token_type\":\"example\",\n  \"expires_in\":3600,\n  \"example_parameter\":\"example_value\"\n}\n"}]}]}]},{type:b,value:c},{type:a,tag:aB,props:{id:aC},children:[{type:a,tag:h,props:{href:"#%E7%B0%A1%E6%98%93%E6%95%B4%E7%90%86",ariaHidden:i,tabIndex:j},children:[{type:a,tag:k,props:{className:[l,m]},children:[]}]},{type:b,value:aC}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:a,tag:r,props:{alt:s,src:"https:\u002F\u002Fi.imgur.com\u002F4cIcic1.png"},children:[]}]},{type:b,value:c},{type:a,tag:aB,props:{id:"doauth端點範例"},children:[{type:a,tag:h,props:{href:"#doauth%E7%AB%AF%E9%BB%9E%E7%AF%84%E4%BE%8B",ariaHidden:i,tabIndex:j},children:[{type:a,tag:k,props:{className:[l,m]},children:[]}]},{type:b,value:"d.OAuth端點範例"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"上述探討完四種認證流程形式，那實際使用OAuth時，端點的形式該如何設計?下述為常見的幾個有名的網站"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:a,tag:r,props:{alt:s,src:"https:\u002F\u002Fi.imgur.com\u002F1pHhAR6.png"},children:[]}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"書中筆者比較建議的方式是像 \u002Foauth2\u002Ftoken此種方式去設計，因為明確指出使用的是OAuth2.0，並且與RFC 6749給出的範例雷同。"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:b,value:"我們稍微看一下實際medium在索取facebook認證資訊時的內容如下圖，基本上也是照這邏輯下去設計"}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:a,tag:r,props:{alt:s,src:"https:\u002F\u002Fi.imgur.com\u002F0LUwjmj.png"},children:[]}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:a,tag:h,props:{href:Z,rel:[D,E,F],target:G},children:[{type:b,value:"OAuth2.0"}]}]},{type:b,value:c},{type:a,tag:d,props:{},children:[{type:a,tag:h,props:{href:"https:\u002F\u002Fblog.yorkxin.org\u002Fposts\u002Foauth2-1-introduction.html",rel:[D,E,F],target:G},children:[{type:b,value:"OAuth 2.0 筆記"}]}]}]},dir:"\u002Fzh\u002Fweb-api",path:"\u002Fzh\u002Fweb-api\u002Fchapter2",extension:".md",createdAt:aD,updatedAt:aD,readingStats:{text:"15 min read",minutes:14.655,time:879300,words:2931},to:"\u002Fweb-api\u002Fchapter2"},prev:{title:"Chapter 07 部署流水線原則與工具設計",path:"\u002Fzh\u002Fcicd-2.0\u002Fchapter7",to:"\u002Fcicd-2.0\u002Fchapter7"},next:{title:"第5章 開發方便更改設計的API",path:"\u002Fzh\u002Fweb-api\u002Fchapter5",to:"\u002Fweb-api\u002Fchapter5"}}],fetch:{},mutations:[]}}("element","text","\n","p","td","tr","left","a","true",-1,"span","icon","icon-link","li","th","code","h6","img","","table","thead","tbody","參數名","填什麼\u002F意義","div","nuxt-content-highlight","pre","language-text","line-numbers","nofollow","noopener","noreferrer","_blank",3,"h3","ul","流程示意","scope","hr","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","Authorization Code","strong","state","申請的存取範圍","詳細流程","client_id","自己的 Client ID","redirect_uri","【Client】POST -\u003E 【Token Endpoint】","grant_type","Authorization Server 的處理程序","https:\u002F\u002Fdatatracker.ietf.org\u002Fdoc\u002Fhtml\u002Frfc6749","h5","流程細節","password","第2章 EndPoint設計與請求形式","關於登錄oauth2026210","關於登錄OAuth2.0(2.6~2.10)","26-陽春認證","27-oauth的基本認證機制","2.7 OAuth的基本認證機制","28-oauth-20-的角色定義","2.8 OAuth 2.0 的角色定義","29-oauth的認證流程形式grant-type","2.9 OAuth的認證流程形式(Grant Type)","210-authorization-code","https:\u002F\u002Freurl.cc\u002FKrvVoe","Implicit","Resource Owner Password Credentials","Client Credentials","(1) Authorization Request","第一步是 Client 產生一個 URL 連到 Authorization Endpoint ，要 Resource Owner 打開（點擊）這個 URL ，從而產生「向 Authorization Endpoint 發送 GET request」的操作。","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","response_type","內部狀態","申請結果下來之後要轉址去哪裡","(4) Authorization Response","Resource Owner 若同意授權，這個「同意授權」的 request 會往 Authorization Endpoint 發送，接著會收到 302 的轉址 response ，裡面帶有「前往 Client 的 Redirection Endpoint 的 URL」的轉址 (Location header)，從而產生「向 Redirection URI 發送 GET Request」的操作。","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","要求 Client 認證自己（如果是 Confidential Client 或有拿到 Client Credentials）","如果 Client 有出示認證資料，就認證它","h4","簡易整理","2022-05-12T12:50:38.105Z")));