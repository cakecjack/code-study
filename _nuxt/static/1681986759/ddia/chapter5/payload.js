__NUXT_JSONP__("/ddia/chapter5", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){return {data:[{document:{slug:"chapter5",description:y,title:y,position:295,category:"資料密集型應用系統設計",menuTitle:"Chapter 05",contributors:["pomeloJ"],toc:[{id:t,depth:l,text:t},{id:u,depth:l,text:u},{id:v,depth:l,text:v},{id:w,depth:l,text:w},{id:x,depth:l,text:x}],body:{type:"root",children:[{type:c,tag:"style",props:{},children:[{type:a,value:"\n  tr, th, td {\n    border: none!important;\n  }\n  .nolinebreak {\n    white-space: nowrap;\n  }\n  .movepadding {\n    padding-left: 2%!important;\n  }\n"}]},{type:a,value:b},{type:c,tag:m,props:{id:t},children:[{type:c,tag:n,props:{ariaHidden:o,href:"#%E5%BC%95%E8%A8%80",tabIndex:p},children:[{type:c,tag:q,props:{className:[r,s]},children:[]}]},{type:a,value:t}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"複製資料的目的："}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"使資料與使用者在地理上接近（減少延遲）"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"提高系統可用性（即使部分故障）"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"提高讀取吞吐量（伸縮讀請求機器數量）"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"複製資料系統的挑戰："}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"假設資料集非常小"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"假設每臺機器可以儲存整個資料集的副本"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"處理資料的變更"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"變更複製演算法："}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"單領導者（single leader）"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"多領導者（multi leader）"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"無領導者（leaderless）"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"複製權衡："}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"同步複製 vs 非同步複製"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"處理失敗的副本"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"複製算法歷史："}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"70 年代研究"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"分散式資料庫變為主流"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"複製延遲問題："}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"最終一致性（eventual consistency）"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"讀己之寫（read-your-writes）"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"單調讀（monotonic read）"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:m,props:{id:u},children:[{type:c,tag:n,props:{ariaHidden:o,href:"#%E9%A0%98%E5%B0%8E%E8%80%85%E8%88%87%E8%BF%BD%E9%9A%A8%E8%80%85",tabIndex:p},children:[{type:c,tag:q,props:{className:[r,s]},children:[]}]},{type:a,value:u}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"副本（replica）：儲存資料庫複製的節點。"}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"確保所有資料落在所有副本上的問題：\n向資料庫的寫入操作需要傳播到所有副本。"}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"基於領導者的複製（leader-based replication）："}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"領導者（leader）：負責接收寫入操作。"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"追隨者（followers）：負責拉取日誌並更新本地資料庫副本。"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"複製過程："}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"客戶端將寫入請求傳送給領導者。"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"領導者將新資料寫入本地儲存。"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"領導者將資料變更傳送給所有追隨者（複製日誌\u002F變更流）。"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"追隨者按照相同處理順序更新本地資料庫副本。"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"讀取操作：客戶端可以向領導者或任一追隨者進行查詢。"}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"基於領導者的複製應用範例："}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"關係資料庫：PostgreSQL（9.0 版本開始）、MySQL、Oracle Data Guard、SQL Server 的 AlwaysOn 可用性組。"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"非關係資料庫：MongoDB、RethinkDB、Espresso。"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"分散式訊息代理：Kafka、RabbitMQ 高可用佇列。"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"網路檔案系統：DRBD 等塊複製裝置。"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:g,props:{className:[h,i]},children:[{type:a,value:j},{type:c,tag:k,props:{src:"\u002Fcode-study\u002Fimages\u002Fddia\u002Fchapter5\u002Ffig5-1.png"},children:[]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"圖 5-1 基於領導者的（主\u002F從）複製"}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:m,props:{id:v},children:[{type:c,tag:n,props:{ariaHidden:o,href:"#%E5%90%8C%E6%AD%A5%E8%A4%87%E8%A3%BD%E8%88%87%E9%9D%9E%E5%90%8C%E6%AD%A5%E8%A4%87%E8%A3%BD",tabIndex:p},children:[{type:c,tag:q,props:{className:[r,s]},children:[]}]},{type:a,value:v}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"複製細節：複製可以是同步（synchronously）或非同步（asynchronously）。"}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"同步複製：主庫在報告寫入成功前，需要等待從庫確認已收到寫入操作。"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"非同步複製：主庫傳送訊息，但不等待從庫響應。"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"同步複製的優缺點："}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"優點：從庫保證有與主庫一致的最新資料副本。"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"缺點：同步從庫無響應時，主庫無法處理寫入操作。"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"半同步複製（semi-synchronous）："}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"一個從庫是同步的，其他的從庫則是非同步的。"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"同步從庫不可用或緩慢時，將一個非同步從庫改為同步執行。"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"完全非同步複製："}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"主庫失效且不可恢復時，尚未複製給從庫的寫入會丟失。"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"優點：主庫可以繼續處理寫入，即使所有從庫都落後。"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"鏈式複製（chain replication）："}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"同步複製的一種變體，旨在不丟資料並提供良好效能和可用性。"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"已在一些系統中實現，例如 Microsoft Azure Storage。"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:g,props:{className:[h,i]},children:[{type:a,value:j},{type:c,tag:k,props:{src:"\u002Fcode-study\u002Fimages\u002Fddia\u002Fchapter5\u002Ffig5-2.png"},children:[]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"圖 5-2 基於領導者的複製：一個同步從庫和一個非同步從庫"}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"複製的一致性與共識（consensus）："}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"第九章將詳細探討共識理論。"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"本章主要討論實踐中的資料庫常用的簡單複製形式。"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"設定新從庫："}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"獲取主庫一致性快照。"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"將快照複製到新的從庫節點。"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"從庫連線到主庫並拉取快照後的所有資料變更。"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"從庫趕上主庫後，可以繼續及時處理主庫資料變化。"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"處理節點宕機："}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"以基於領導者的複製實現高可用。"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"從庫失效：追趕恢復"}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"重新連線到主庫。"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"請求並處理斷開期間的所有資料變更。"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"主庫失效：故障切換"}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"確認主庫失效。"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"選擇新的主庫。"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"重新配置系統以啟用新的主庫。"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"故障切換過程中可能出現的問題："}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"非同步複製導致資料損失。"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"與其他外部儲存協調時的問題。"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"腦裂問題。"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"超時配置的困難。"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"儘管有些軟體支援自動故障切換，但許多運維團隊仍更願意手動執行故障切換。"}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"分散式系統中的基本問題包括節點故障、不可靠的網路、副本一致性、永續性、可用性和延遲。這些問題將在第八章和第九章中深入討論。"}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"複製日誌的實現可以分為以下幾種："}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"基於語句的複製：主庫記錄每個寫入請求並將語句日誌傳送給從庫。但這種方式存在諸多問題，如非確定性函式、自增列、副作用等。"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"傳輸預寫式日誌（WAL）：主庫將日誌通過網路傳送給從庫。此方法使複製與儲存引擎緊密耦合，升級資料庫軟體可能需要停機。"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"邏輯日誌複製（基於行）：對複製和儲存引擎使用不同的日誌格式，使主庫和從庫能夠執行不同版本的資料庫軟體或儲存引擎。邏輯日誌格式更容易解析，有利於資料變更捕獲（change data capture）。"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"基於觸發器的複製：通過資料庫中的觸發器和儲存過程，將資料更改記錄到單獨的表中，再使用外部程式讀取該表並將資料變更複製到另一個系統。儘管開銷較大且容易出錯，但基於觸發器的複製具有很高的靈活性。"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"以上四種複製方式各有優缺點，具體應用需根據實際情況選擇合適的複製方法。"}]},{type:a,value:b},{type:c,tag:m,props:{id:w},children:[{type:c,tag:n,props:{ariaHidden:o,href:"#%E8%A4%87%E8%A3%BD%E5%BB%B6%E9%81%B2%E5%95%8F%E9%A1%8C",tabIndex:p},children:[{type:c,tag:q,props:{className:[r,s]},children:[]}]},{type:a,value:w}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"複製的原因"}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"容忍節點故障"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"可伸縮性（處理比單個機器更多的請求）"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"延遲（讓副本在地理位置上更接近使用者）"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"基於領導者的複製與最終一致性"}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"只讀查詢可以由任何一個副本來處理"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"讀伸縮體系結構\n"},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"新增更多的從庫，提高只讀請求的服務容量"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"實際上只適用於非同步複製"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"最終一致性\n"},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"非同步從庫讀取可能看到過時的資訊"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"副本落後的程度是沒有限制的"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"複製延遲可能僅僅是幾分之一秒或達到幾分鐘"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"複製延遲問題與解決方法"}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"問題例項\n"},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"不一致性是應用設計中的真實問題"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"三個可能發生的問題例項"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"讀己之寫"}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"適用情境\n"},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"應用讓使用者提交資料並檢視提交內容"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"資料經常被檢視，偶爾寫入"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"非同步複製的問題\n"},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"寫入後馬上檢視資料，新資料可能尚未到達副本"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"使用者可能看到資料丟失"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:g,props:{className:[h,i]},children:[{type:a,value:j},{type:c,tag:k,props:{src:"\u002Fcode-study\u002Fimages\u002Fddia\u002Fchapter5\u002Ffig5-3.png"},children:[]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"圖 5-3 使用者寫入後從舊副本中讀取資料。需要寫後讀 (read-after-write) 的一致性來防止這種異常"}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"寫後讀一致性"}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"定義\n"},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"使用者重新載入頁面時，總是看到自己提交的更新"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"不對其他使用者的寫入做出承諾"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"實現方法\n"},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"對使用者可能修改過的內容，總是從主庫讀取"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"跟蹤上次更新的時間，在更新後一定時間內從主庫讀取"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"監控從庫複製延遲，防止向滯後主庫超過一定時間的從庫發出查詢"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"客戶端記住最近一次寫入的時間戳，確保從庫在處理該使用者的讀取請求時已經更新"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"如果副本分佈在多個數據中心，將主庫提供服務的請求路由到包含該主庫的資料中心"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"跨裝置寫後讀一致性\n"},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"需要提供跨裝置的寫後讀一致性"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"考慮問題：\n"},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"記住使用者上次更新時間戳的方法變得困難，需對元資料進行中心化儲存"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"難以保證來自不同裝置的連線會路由到同一資料中心，可能需要把來自該使用者所有裝置的請求都路由到同一個資料中心"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"單調讀"}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"非同步從庫讀取異常\n"},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"時光倒流\n"},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"發生原因：使用者從不同從庫進行多次讀取"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"解決方法：單調讀（monotonic reads）"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"因果律違反\n"},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"發生原因：分割槽（partitioned）或分片（sharded）資料庫中複製速度不一致"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"解決方法：一致字首讀（consistent prefix reads）"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:g,props:{className:[h,i]},children:[{type:a,value:j},{type:c,tag:k,props:{src:"\u002Fcode-study\u002Fimages\u002Fddia\u002Fchapter5\u002Ffig5-4.png"},children:[]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"圖 5-4 使用者首先從新副本讀取，然後從舊副本讀取。時間看上去回退了。為了防止這種異常，我們需要單調的讀取。"}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"解決複製延遲的方法"}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"設計系統來提供更強的保證（例如 寫後讀）"}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"透過主庫進行某種讀取"}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"使用事務（transaction）來簡化應用程式開發"}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"單節點事務"}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"分散式（複製和分割槽）資料庫事務（將在 第七章 和 第九章 探討）"}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"替代機制（將在 第三部分 探討）"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:g,props:{className:[h,i]},children:[{type:a,value:j},{type:c,tag:k,props:{src:"\u002Fcode-study\u002Fimages\u002Fddia\u002Fchapter5\u002Ffig5-5.png"},children:[]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"圖 5-5 如果某些分割槽的複製速度慢於其他分割槽，那麼觀察者可能會在看到問題之前先看到答案。"}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:m,props:{id:x},children:[{type:c,tag:n,props:{ariaHidden:o,href:"#%E5%A4%9A%E4%B8%BB%E8%A4%87%E8%A3%BD",tabIndex:p},children:[{type:c,tag:q,props:{className:[r,s]},children:[]}]},{type:a,value:x}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"基於領導者的複製模型"}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"單個主庫"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"缺點：所有寫入必須透過主庫"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"多領導者配置（multi-leader configuration）"}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"允許多個節點接受寫入"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"適用場景：\n"},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"運維多個數據中心"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:g,props:{className:[h,i]},children:[{type:a,value:j},{type:c,tag:k,props:{src:"\u002Fcode-study\u002Fimages\u002Fddia\u002Fchapter5\u002Ffig5-6.png"},children:[]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:b},{type:c,tag:f,props:{},children:[{type:a,value:"圖 5-6 跨多個數據中心的多主複製"}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"效能"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"容忍資料中心停機"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"容忍網路問題\n"},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"需要離線操作的客戶端"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"手機、膝上型電腦和其他裝置上的日曆應用"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"非同步的多主複製過程\n"},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"協同編輯"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"實時協作編輯應用程式"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:g,props:{className:[h,i]},children:[{type:a,value:j},{type:c,tag:k,props:{src:"\u002Fcode-study\u002Fimages\u002Fddia\u002Fchapter5\u002Ffig5-7.png"},children:[]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"圖 5-7 兩個主庫同時更新同一記錄引起的寫入衝突\n"},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"與離線編輯用例相似"}]},{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"缺點：寫衝突需解決\n"},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"多主複製的挑戰：配置缺陷、意外反應、麻煩功能"}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:g,props:{className:[h,i]},children:[{type:a,value:j},{type:c,tag:k,props:{src:"\u002Fcode-study\u002Fimages\u002Fddia\u002Fchapter5\u002Ffig5-8.png"},children:[]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"圖 5-8 三種可以在多主複製中使用的拓撲示例。"}]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:g,props:{className:[h,i]},children:[{type:a,value:j},{type:c,tag:k,props:{src:"\u002Fcode-study\u002Fimages\u002Fddia\u002Fchapter5\u002Ffig5-9.png"},children:[]},{type:a,value:b}]},{type:a,value:b},{type:c,tag:e,props:{},children:[{type:a,value:b},{type:c,tag:d,props:{},children:[{type:a,value:"圖 5-9 使用多主複製時，寫入可能會以錯誤的順序到達某些副本。"}]},{type:a,value:b}]}]},dir:"\u002Fzh\u002Fddia",path:"\u002Fzh\u002Fddia\u002Fchapter5",extension:".md",createdAt:z,updatedAt:z,readingStats:{text:"14 min read",minutes:13.14,time:788400,words:2628},to:"\u002Fddia\u002Fchapter5"},prev:{title:"Chapter 04 編碼與演化",path:"\u002Fzh\u002Fddia\u002Fchapter4",to:"\u002Fddia\u002Fchapter4"},next:{title:"Appendix 00 Redis快速入門",path:"\u002Fzh\u002Fddia\u002Fappendix00",to:"\u002Fddia\u002Fappendix00"}}],fetch:{},mutations:[]}}("text","\n","element","li","ul","p","div","flex","justify-between","\n  ","img",2,"h2","a","true",-1,"span","icon","icon-link","引言","領導者與追隨者","同步複製與非同步複製","複製延遲問題","多主複製","Chapter 05 複製","2023-04-20T10:31:34.275Z")));